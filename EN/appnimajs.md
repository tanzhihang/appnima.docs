App/nima.JS
===========
Find out how to add soul to your apps with first LaaS in the world.

*Current version: [1.0.0]()*

To have appnima.js ready to work with you only have to set the value of the variable `Appnima.key` with the key that APP/NIMA provides you on the application creation:

    Appnima.key = "YOUR_KEY";

App/nima store user's session data in memory, so the session will persist in time.


Promises
--------
Appnima.js uses the promise pattern to handle each request, so to attach a callback (with error and result) to each request we have to do it using `.then` as it is shown in the following example:

    Appnima.resource().then(function(error, result){
        if(error !== null){
            console.log("Error", error);
        }else{
            console.log("Success", result);
        }
    });


Error Handler
-------------
Appnima.js has the capability to centralize the error management in a method. To use this, just assign to Appnima.onError a callback function that will receive the generated error:

    Appnima.onError = function(error){
        console.log("CODE: ", error.code);
        console.log("TYPE: ", error.type);
        console.log("MESSAGE: ", error.message);
    };

Token Management
----------------
App/nima uses a token to access the resources. When a token is expired the server will return a `480` error code, to refresh the token the method `Appnima.User.token()` must be called. It will do all the necessary transactions to update your token so you can continue working.

User
====
Basic
-----
#### Signup
To register a user in your application you only need to call the following method using as parameters the email, password and optionally a username:

    Appnima.User.signup ("javi@tapquo.com", "USER_PASSWORD");


#### Login
Login a user is as easy as calling the resource with the email and password:

    Appnima.User.login("javi@tapquo.com", "USER_PASSWORD");


#### Logout
If you want to logout a user of your application as simple as calling the method *logout* without any parameter:

    Appnima.User.logout();


#### Information
Do you need all the data registered by a user? Just call this resource to get information:

    Appnima.User.info();

In addition, to obtain information of any user of App/nima, you only have to send the id of this user to the previous method:

    Appnima.User.info(1244545632);


The object you will receive in both cases is:

```json
    {
        _id:            28319319832
        mail:           "javi@tapquo.com",
        username:       "soyjavi",
        name:           "Javi Jimenez",
        avatar:         "http://USER_AVATAR_URL",
        bio:            "Founder & CTO at @tapquo",
        phone:          "PHONE_NUMBER",
        token:          "USER_TOKEN",
        refresh_token:  "REFRESH_TOKEN"
    }
```


#### Update
The `update` resource also allows users to update their data. To do this just call it using as parameter a dictionary that contains all this optional fields:

    data = {
        mail: "inigo@tapquo.com",
        username: "haas85",
        name: "Inigo",
        avatar: "http://AVATAR_URL",
        picture: "http://PICTURE_URL",
        phone: "29306832906",
        site: "http://tapquo.com",
        bio: ""
    }

    Appnima.User.update(data);


#### Avatar
Your users can upload their own avatar file. To upload an avatar use this resource using as parameter the avatar coded in Base64:

    Appnima.User.avatar(USER_AVATAR);

Password
--------
APP/NIMA offers its users two ways to deal passwords, remember it or change it.

#### Remember password
Esta acción se realiza mediante dos funciones. Primero habría que llamar al siguiente método:

    Appnima.User.rememberPassword("jdkdksj421432k", "http://application_domain", "reset_password");

The first parameter is the user ```token``` of APP/NIMA, that is, the user ```access_token```. The second parameter is the domain of the application that calls this function and the latter parameter the url that you want to call.

This function sends a mail to the user who owns the token from APP/NIMA with a URL as follows:

    DOMINIO/URL/CODE -> http://application_domain/reset_password/25kj4fkwnfmndjkhgjk4h5nmf

The code is generated by APP/NIMA and serves to identify which user request asked to remember the password. For this, as you can see, it is necessary to generate an endpoint in the backend of the application with this URL where there is a form where you fill in the desired new password. So you have to call the following method:

    Appnima.User.resetPassword("25kj4fkwnfmndjkhgjk4h5nmf", "12345");

The first parameter is the URL code generated in the previous step and the second parameter is the new password that the user wants to regenerate. Once done, APP/NIMA sends an email telling user that the password has been changed.

In the case of not having application backend, APP/NIMA offers a view to regenerate the password to the user. This method should be called:

    Appnima.User.rememberPassword("fdfadsfdsf");

Passing only the user's token you want to regenerate the password and APP/NIMA will send you an email with the URL where regenerating own password.

#### Change password
With this feature you can change your password directly. The only requirement is that the user is logged in with APP/NIMA, and then have to call the following method:

    Appnima.User.changePassword("12345", "67890");

The first parameter is the old password and the second is the new password.

Terminal
--------

#### Register or Update
With this resource you can register or update the device the user is using to access the application. The request is done in the following way:

    Appnima.User.terminal("Android", "Phone", "MobilePhone", "4.1");

#### Info
Get the terminals that the user has used to access to the application using this resource:

    Appnima.User.teminal();

The data you will receive will be like:

```json
    [{
        _id:        "5719721071057"
        type:       "phone",
        os:         "ios",
        token:      "OHSAF9075HFQ",
        version:    "6.0"
    },
    {
        _id:        "57592807235"
        type:       "desktop",
        os:         "macos",
        token:      "89YWEOFOGH022GB",
        version:    "10.8"
    }]
```


Subscription
------------
If you need it, you can ask users to register their emails to get an invitation to the app. Just call the resource using the email as parameter:

    Appnima.User.subscribe("javi@tapquo.com");


Tickets
-------
Use this resource as ticket managing system to resolve incidences or attend consults from users. The resource only needs the text:

    Appnima.User.ticket("[SUGGESTION] Bigger buttons");



Messenger
=========

Mail
----
Your application's users can send emails to other users using this resource. To do this, the parameters that are needed are: receiver's ID, the subject and the email body:

    Appnima.Messenger.mail("28319319832". "Meeting", "Tomorrow morning");

SMS
---
APP/NIMA also provides a SMS service. To use this resource the parameters needed are the receivers ID and the message:

    Appnima.Messenger.sms("28319319832". "Remember that your appointment is tomorrow");

Messages
--------
#### Private messages
To use the APP/NIMA's private message service just call the resource using the following parameters: Receiver's ID, message body and optionally the subject:

    Appnima.Messenger.message("28319319832". "Where are you? I'm at home waiting for you.", "Where are you?");


#### Inbox
You can get the unread messages you have received by just calling this resource:

    Appnima.Messenger.messageInbox();

#### Outbox
As we do with received messages we can get the list of of sent messages, just use this resource:

    Appnima.Messenger.messageOutbox();

#### Conversation
For to get message exchanged with another user, both received as sent, is used this method, which receives as parameter the username of another user.

    Appnima.Messenger.conversation(username);

#### Mark as read
To mark a message as read call this resource using the message id as parameter:

    Appnima.Messenger.readMessage("28319319832");

#### Summary
This method allows you to obtain a list containing the last message you've sent or received by each user.

    Appnima.Messenger.summary();

#### Search
You can do a search from your messages sent and received across a word that contain both the message subject such the message's body.

    Appnima.Messenger.search("node");

#### Delete message
To delete a message cal this resource using the message id as parameter:

    Appnima.Messenger.deleteMessage("28319319832");


Relathionships
==============
#### Follow
You can follow a user using this resource, call this resource using the user to follow's id as parameter:

    Appnima.Network.follow("28319319832");


#### Unfollow
You can unfollow a user using this resource, call this resource using the user to unfollow's id as parameter:

    Appnima.Network.unfollow("28319319832");


#### Following
With this resource you can get the list of people that a user is following. It works as the previous parameter, accepting an optional user id parameter:

    Appnima.Network.following();

    Appnima.Network.following("28319319832");

On the other hand, there is also the option for you to return the list with pagination, that is, that in each API call returning part of the list of users. This should be sent only two variables along with the user id:

    Appnima.Network.following("28319319832", 0, 5);

The first variable is the page number you want to obtain, that is, the part of the list you want to get. Second number is the number of results you want to obtain. In the first call, this variable will be multiplied by 2, and in other cases, this variable is the same.

#### Followers
With this resource you can get the list of people that follow a user. It works as the previous parameter, accepting an optional user id parameter:

    Appnima.Network.followers();

    Appnima.Network.followers("28319319832");

Like as explained above, it is also possible to obtain results with pagination. The mode of this is the same as getting the users you follow.

In this case, the call returns one more variable in each object. This variable indicate that user is loggued is follow or not that user.

#### Friends
You can also obtain the session's friends, a friend is considered the user having a reinforced relationship (follower / following)

    Appnima.Network.friends();

#### Information
This resource returns a user's relationships' stats and counts of followers and followings. If we use a user's id as parameter it will return his stats, if not, logged user's stats:

    Appnima.Network.info();

    Appnima.Network.info("28319319832");


#### Check
With this resource yoa can get information about logged user's realtionship with other user, if I am following him and if he is my follower:

    Appnima.Network.check("28319319833");


#### Search
You can search for other users using this resource. For this use as parameter an email or username to search:

    Appnima.Network.search("javi@tapquo.com");


Posts
--------
#### Create
Users can create posts within an application. For this they have to send the following parameters with the request:

    title   = "Lorem Ipsum"
    content = "Lorem ipsum dolor sit amet, consectetur adipisicing elit."
    image   = "http://IMAGE_URL"

    Appnima.Network.Post.create(content, title, image);

Only ```content``` parameter is required. An example of how to create a ```post``` with only content is the following.

    Appnima.Network.Post.create(content);

This call will return an object with information on the new post:

    post = {
        id         : 4234325425234,
        content    : "Lorem Ipsum",
        image      : "http://IMAGE_URL",
        owner      : {
            id       : 423423432423,
            name     : user1,
            username : username1,
            avatar   : http://AVATAR_URL
        },
        comments   : [],
        likes      : [],
        is_liked   : false,
        created_at : POST_CREATED_DATA
    }

#### Update
The user can update created post. To do this, user must send the following parameters:

    post_id = 124523132
    content = "Lorem Ipsum update content"
    title   = "Lorem Ipsum update title"
    image   = "http://IMAGE_URL"

    Appnima.Network.Post.update(post_id, content, title, image);

Not required to send the data that will not be modified. Two examples of this would be:

    Appnima.Network.Post.update(post_id, content, null, image);
    Appnima.Network.Post.update(post_id, content, title);

As can be seen, in the first case, you want to change the content and the image but not the title, so you must send that field to null.

In the second case, you want to change the content and the title and image as the last parameter is not necessary to pass null. The same would happen in the following case:

    Appnima.Network.Post.update(post_id, content);

In this case you only want to modify the content and therefore, other variables that go behind would not need to send in null.

This method returns ```message:" Successful "``` if all went well.

#### Delete
The user can delete created post.
El usuario que ha creado un post puede borrarlo. To do this only has to send the id of the post to be deleted:

    post_id = 124523132

    Appnima.Network.Post.remove(post_id);

As in the previous method, if all went well return a message ```message: "Successful"```

#### Get a post
The user can get the information of a concrete post sending ```id``` of that post.

    post_id = 124523132

    Appnima.Network.Post.get(post_id);

This call return following data:

    post = {
        id         : 4234325425234,
        content    : "Lorem Ipsum",
        image      : "http://IMAGE_URL",
        owner      : {
            id       : 423423432423,
            name     : user1,
            username : username1,
            avatar   : http://AVATAR_URL
        },
        comments   : [
                {
                    id: 4324234,
                    content: "Comment 1",
                    created_at: comment_created_data,
                    owner: {
                        avatar: http://AVATAR_URL,
                        id: 3425425425,
                        name: user,
                        username: username
                    }
                }
            ],
        likes      : [
            {
                avatar: http://AVATAR_URL,
                id: 3425425425,
                name: user,
                username: username
            },
            {
                avatar: http://AVATAR_URL,
                id: 86765545678,
                name: user1,
                username: username1
            },
        ],
        is_liked   : false,
        created_at : POST_CREATED_DATA
    }

The list of likes are users who have made like this post.

#### Search
The user can search for a particular post by the text of its content, or if it sends just a word, it will return all posts that contain that word in their content.

    query = "lorem"
    page  = 1
    num_results = 12
    last_data = last_data

    Appnima.Network.Post.search(query, page, num_results, las_data);

As can be seen, in this case the results are to be obtained by pagination, as explained above. But if it does not wish to use it, you simply have to make the call as follows:

    Appnima.Network.Post.search(query);

In this case, both methods return an array of the post has been found, or an empty array if none match.

#### Counter
This method is used to obtain the counter of post that user created. The answer is ```posts_count:8 ```. In this example, the user of the session would have created eight post.

    Appnima.Network.Post.counter();
    Appnima.Network.Post.counter(424234234324);

If user sends an user id, method return counter of that user.

#### Timeline
This method is used to obtain a list of post. There would be two different ways of creating two different results. A case would be:

    Appnima.Network.Post.timeline();
    Appnima.Network.Post.timeline(null, page, num_results, last_data);

In this case, the first call would get the ```timeline``` of session user. This is a list of post that user created and those who user follow. (Easy example to understand is the timeline of ```Twitter```).

In second call is the same, only to be get posts by pagination.
The other case would be:

    Appnima.Network.Post.timeline(username);
    Appnima.Network.Post.timeline(username, page, num_results, last_data);

In this case you are getting the timeline of a specific user, the post he has written. (Next to the example of Twitter, this case would be when you enter in to the profile of a particular user). As you can see, you can also do by pagination.

#### Create comment
Posts may have comments, and with this call user can do comments.

    post_id = 424231423423
    content = Este es mi comentario

    Appnima.Network.Post.createComment(post_id, content);

Call returns ```message: "Successful"```.

#### Delete comment
The user who created a comment can delete his comments with following method sending comment ```id```:

    Appnima.Network.Post.deleteComment(4234324234234);

Call returns ```message: "Successful"```.

#### Get comment
To obtain all comments of post the user may to call this method sending ```id```of post:

    Appnima.Network.Post.comments(424231423423);

This call return following array of objects:

    comments   : [
                {
                    id: 4324234,
                    content: "Comment 1",
                    created_at: comment_created_data,
                    owner: {
                        avatar: http://AVATAR_URL,
                        id: 3425425425,
                        name: user,
                        username: username
                    }
                },
                {
                    id: 43265453745,
                    content: "Comment 2",
                    created_at: comment_created_data,
                    owner: {
                        avatar: http://AVATAR_URL,
                        id: 3425425425,
                        name: user,
                        username: username
                    }
                }
            ]

#### Do like post
The user can do favorite a concret post, or remove that "like". For this, the user must send the id of the post along with the call:

    Appnima.Network.Post.like(424231423423);

If it is the first time that user do like a post, this will be created, but on the contrary, if this post already has favorite, the favorite will disappear and the next time this method is called again to be favorite.
If all went well return ```message:" Successful "```.

#### Get users who have made a post favorite
If the user wants to get all users who have a favorite post in particular, you simply send the id of the post along with the following call:

    Appnima.Network.Post.likeUsers(424231423423);

This method return following data:

    users   : [
                {
                    id: 54364758,
                    name: user1,
                    username: usernam1,
                    avatar: http://AVATAR_URL,
                    bio: biouser1
                }
            ]

#### Get all favorite posts from an user
If you want to get the favorite post of user, you want to do this method sending user username:

    Appnima.Network.Post.userLike("username");

The API will return a list of post, which are favorites for the username's user.

They can also be obtained by pagination:

    Appnima.Network.Post.userLike("username", page, num_results, last_data);

Location
========
Places
------
#### Search
Using the users latitude and longitude or any point you can get the nearest places such as museums, restaurants, public buildings… You also can provide a search radius to get a more accurate search. To do this use this respource  with the latitude, longitude and radius:

    Appnima.Location.places("43.6525842", "-79.3834173, 100");


#### Info
Get detailed information from a place using this resource. Send the `ID` and `REFERENCE` with the request:

    Appnima.Location.place("28319319833", "CqQBlwAAAEXdx350jL2InIRtksTkbZJ-m");


#### Add
In APP/NIMA you can add a place and add relevant information such as name, address, phone number… To do this yo have to use this resource with the following parameters: Name, address, locality, Postal Code, Country, latitude and longitude:

    Appnima.Location.add("Talleres Juan", "C/ Laubide 10", "Mungia", "48100", "ES", "43.354", "-2.8467");

Optionally you can add email, phone and web site data.


#### Checkins
You users can register the places where they are. Send the `ID` and `REFERENCE` with the request:

    Appnima.Location.checkin("28319319833", "CqQBlwAAAEXdx350jL2InIRtksTkbZJ-m");

You can get the list of checkins with this resource. The unique parameter needed is the user's id:

    Appnima.Location.checkins("28319319833");


People
------
#### Friends around
You can ask APP/NIMA for the friends that are near to you. The parameters needed are the latitude, longitude and radius:

    Appnima.Location.friends("43.6525842", "-79.3834173, 100");


#### People around
You can ask APP/NIMA for the people that is near to you. The parameters needed are the latitude, longitude and radius:

    Appnima.Location.people("43.6525842", "-79.3834173, 100");


Push
====
To send push notifications to the devices that the users have registered the data needed is: User's ID, the notification text, and the content of the notification.

    Appnima.Push.send("28319319833", "Mensaje", {"title": "JSON con los campos necesarios", "text": "Hola App/nima!"});


Socket
======
Groups
------
The groups are persistent rooms from 1 to N users. In the groups only allowed users can connect and send data. To work with groups an instance of group must be created:

    group = new Appnima.Socket.Group();

Create a group:

    group.create("name", ["2387569328yvc2","21y89ch3x8hg2032","2938tyh2g0ghh0i2bg8"]);

Get the groups I take part:

    group.list().then(function(error, groups){[code]});

Remove group:

    group.remove("id");

Change the name of the group:

    group.rename("id", "name");

Get the messages of the group. The second parameter is the page number, the first page is 0 and each page have 50 messages:

    group.messages("id", 0);

Delete unread messages count, the first parameter is the group id:

    group.deleteUnreadCount("id");

Chat
----
Chats are rooms from 1 to N users without persistence. In chats, as happens in the groups, only allowed users can connect and send data.To work with Chats first of all a instance of Chat must be created:

    chat = new Appnima.Socket.Chat();

Create a room:

    chat.create("name", ["2387569328yvc2","21y89ch3x8hg2032","2938tyh2g0ghh0i2bg8"]);


Emiter & Listener
-----------------
#### Emiter
The emiter is a room in which the autor of it is the only person allowed to send messages and the receivers must connect to it using `Appnima.Socket.Listener`. To create it the first thing is creating an instance of Emiter:

    room = new Appnima.Socket.Emiter();

Create a room:

    room.create("context");


#### Listener
The listener connects to rooms created with emiter and receives it messages. To create it the first thing is creating en instance and it will connect automatically to the room:

    listener = new Appnima.Socket.Listener("context");


Application
-----------
The application channel allows the users of an application to communicate with others. To connect to it just create an instance of the application:

    application = new Appnima.Socket.Application();


Inbox
-----
The inbox allows a user to receive messages from other users. The messages will only be received by the room author, but any user can send data.To do this create an instance of Inbox:

    inbox = new Appnima.Socket.Inbox();

Get the unread messages count by group:

    inbox.unreadCount(callback);

Get online friends:

    inbox.onOnlineFriends(callback);

Friend connection/disconnection:

    inbox.onFriendStatusChange(callback);

Send data to an user:

    inbox.sendToUser(user_id, data);


Methods
-------
This methods are the same for all the socket types seen previously:

* `instance.connect("id")`: Connect to a  Group or Chat

* `instance.disconnect()`: Disconnect from a room

* `instance.allowUSers(["","",""…])`: Add allowed users to Groups or Chats

* `instance.disallowUsers(["","",""…])`: Remove users from allewed list

* `instance.send(message)`: Send a message to all the users of a room, also the sender

* `instance.broadcast(message)`: Send a message to all the users of a room, except the sender

* `instance.onConnect(callback)`: Calls to the callback on room connection

* `instance.onError(callback)`: Calls to the callback on error

* `instance.onDisconnect(callback)`: Calls to the callback when the socket disconnect

* `instance.onMessage(callback)`: Calls to the callback on message received, the recived message will be an object like this:
    * content:  "message content"
    * user: {"Information about the sender"}
    * created_at: "2013-11-16T05:55:02.736Z"

* `instance.onDisallow(callback)`: Calls to the callback when a user is disallowed from the group
